<!-- ドキュメント間相互参照 -->
**関連ドキュメント**
- [仕様（要件の体系化・明文化） → spec.md](./spec.md)
- [設計（どう実現するか） → design.md](./design.md)

**このドキュメントの変更が生じた場合**
- requirements.md を変更 → spec.md と design.md を確認・修正してください

# Ink Echo - 満たすべき条件（MVP必須要件）

## 対話フロー（入力〜問い返し）
- <a id="REQ-01"></a>**[REQ-01]** ユーザーはマイクを使って悩みや思考を声で入力できる
- <a id="REQ-02"></a>**[REQ-02]** 入力された音声はSpeech-to-Textによりテキストに変換される
- <a id="REQ-03"></a>**[REQ-03]** 変換されたテキストを基に、Mistral APIが内容を理解する
- <a id="REQ-04"></a>**[REQ-04]** Mistral APIは、Newsletter風の穏やかで共感的な口調（比喩や日常語）を用いつつ、問い返し文のみを生成する
- <a id="REQ-05"></a>**[REQ-05]** 問い返し文はトレードオフ指摘、主体性重視、スタート地点振り返り、Doomer脱出などの要素を暗示する、**1〜2文程度の非常に短い質問のみ**で構成される
- <a id="REQ-06"></a>**[REQ-06]** 生成された問い返し文はElevenLabs TTS APIにより自然な日本語の音声に変換される。聞き取りやすいよう、回答や説明を含めず、問いかけのみを50〜100文字以内で短く行うこと
- <a id="REQ-07"></a>**[REQ-07]** 問い返し音声はユーザーに再生される

## 対話フロー（ターン制限・終了）
- <a id="REQ-08"></a>**[REQ-08]** 対話は最大7ターンに制限される
- <a id="REQ-09"></a>**[REQ-09]** 7ターンに達した場合、対話を強制終了する
- <a id="REQ-10"></a>**[REQ-10]** 7ターン終了時には、以下のメッセージを声で再生する  
  「これ以上話しても、あなたが紙に書かないと何も変わらない。今、ここで重要な気づきを1枚のカードに手書きでまとめて。書いてから写真をアップロードしてね。それがなければ続きはないよ。」
- <a id="REQ-11"></a>**[REQ-11]** 7ターン終了後、マイク入力を無効化する

## 写真アップロードと再開フロー
- <a id="REQ-12"></a>**[REQ-12]** ユーザーは手書きしたカードの写真をアップロードできる
- <a id="REQ-13"></a>**[REQ-13]** アップロードされた写真はMistral Vision APIで解析される
- <a id="REQ-14"></a>**[REQ-14]** 解析では手書き文字の読み取りを行う
- <a id="REQ-15"></a>**[REQ-15]** 解析では主要キーワード・テーマの抽出を行う
- <a id="REQ-16"></a>**[REQ-16]** 解析では前の対話履歴とのリンク候補の提案を行う
- <a id="REQ-17"></a>**[REQ-17]** 解析結果を基に、AIが声で応答を生成する
- <a id="REQ-18"></a>**[REQ-18]** 応答例として「このカード、素晴らしい。では続きを始めよう。でもまた7ターンで区切るよ」などの文を声で再生する
- <a id="REQ-19"></a>**[REQ-19]** 解析結果と対話履歴を基に、対話を再開する
- <a id="REQ-20"></a>**[REQ-20]** 対話履歴はセッション内で保持され、再開時に引き継がれる

## 声の演出（ElevenLabs活用）
- <a id="REQ-21"></a>**[REQ-21]** 問い返し時の声は穏やかで共感的なトーンとする
- <a id="REQ-22"></a>**[REQ-22]** ターン後半の声は少し真剣で鋭いトーンに変化させる
- <a id="REQ-23"></a>**[REQ-23]** 最終締め（7ターン終了メッセージ）の声は静かだが力強く、逃げ場のないトーンとする

## 非機能要件・運用
- <a id="REQ-24"></a>**[REQ-24]** アプリケーションはブラウザだけで動作する（Webアプリ形式）
- <a id="REQ-25"></a>**[REQ-25]** インターネット接続が必須である
- <a id="REQ-26"></a>**[REQ-26]** 対話内容はサーバーに永続保存せず、セッション内（クライアントサイド）のみで扱う
- <a id="REQ-27"></a>**[REQ-27]** プライバシー保護のため、対話データはブラウザを閉じると消去される（MVPでは永続化しない）

## 将来の拡張を考慮した設計思想（MVPでは実装不要だが、満たすべき条件として意識）
- <a id="REQ-28"></a>**[REQ-28]** 将来的にユーザー同意を得た場合に限り、対話履歴を永続保存できる設計思想を持つ
- <a id="REQ-29"></a>**[REQ-29]** 永続保存はオプトイン（ユーザーが明示的に同意した場合）のみ行う
- <a id="REQ-30"></a>**[REQ-30]** 保存先はサーバーレスDB（Cloudflare D1、Supabase、Vercel Postgresなど）を使用可能とする
- <a id="REQ-31"></a>**[REQ-31]** 保存内容は暗号化する（クライアント側またはサーバー側）
- <a id="REQ-32"></a>**[REQ-32]** 複数デバイス間で対話の続きを再開できる仕組みを想定する
- <a id="REQ-33"></a>**[REQ-33]** カードのバージョン管理・検索機能を将来追加可能とする
- <a id="REQ-34"></a>**[REQ-34]** 匿名共有URLによるカード共有機能を将来追加可能とする

## プロダクト自己改善関連（MCPサーバー・W&B Weave統合を意識）
- <a id="REQ-35"></a>**[REQ-35]** 将来的に、蓄積された対話データ（ユーザー同意オプトイン済み・匿名化済み）を用いて、Ink Echo自体の問い返し品質・行動変容効果を継続的に改善できる設計思想を持つ。MCPサーバー経由で公開する場合、W&B Weaveを統合し、すべてのツール呼び出しを自動トレースする
- <a id="REQ-36"></a>**[REQ-36]** プロダクト改善はWeights & Biases Weaveを活用し、Trace・Evaluation・Prompt最適化ループを実現可能とする（例: 高スコア問い返しを抽出 → 新システムプロンプト自動生成）。MCPサーバー使用時は、Weaveのトレース機能でMistral API呼び出しをログし、評価メトリクス（例: ユーザー満足度、行動変容率）を定義・追跡する
- <a id="REQ-37"></a>**[REQ-37]** 自己改善ループは完全にオプトインとし、改善データは個人を特定できない形で集計・利用（プライバシー最優先）。MCPサーバー経由の公開では、データ収集はハッカソンルールに従い、匿名化とGDPR準拠を確保する
- <a id="REQ-38"></a>**[REQ-38]** 改善の対象は問い返しの深さ・主体性促進度・アナログ強制後の継続率・声トーン適合度などとし、MVP哲学（アナログ優先・AIの下働き）を損なわない。MCP統合時は、Weave Evaluationsでこれらのメトリクスを自動評価し、プロンプトエンジニアリングを最適化する
- <a id="REQ-39"></a>**[REQ-39]** ユーザー体験として、改善適用時に「君の声がInk Echoを賢くしてくれたよ。次はもっと深い問い返しができるかも」と声で伝えるメタフィードバックを想定。MCPサーバー使用時は、Weaveダッシュボードでユーザー貢献を可視化し、フィードバックを強化する
- <a id="REQ-40"></a>**[REQ-40]** 将来的にMCPサーバー経由でInk Echoツールを公開した場合、Weave統合で全ツール呼び出しを自動トレースし、W&Bダッシュボードで成長曲線を可視化可能とする。ハッカソン参加時は、MCPのAPIエンドポイントを使用し、Weaveクライアントを初期化してトレースを有効化する
- <a id="REQ-41"></a>**[REQ-41]** MCPサーバー統合時は、Weaveのセットアップを必須とし、プロジェクトをW&Bアカウントにリンク。トレースデータはハッカソン審査基準（イノベーション、効率、影響力）に基づき最適化する
- <a id="REQ-42"></a>**[REQ-42]** データ扱いに関する制約：すべての収集データはオプトイン限定、匿名化必須、保存期間はハッカソン終了までとし、削除ポリシーを明記。プライバシー侵害リスクを最小化
